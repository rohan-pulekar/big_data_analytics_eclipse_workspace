<!DOCTYPE html>
<title>e63 Final Project (Rohan Pulekar)</title>
<meta name="description"
	content="This html file is for final project of e63 course (Big Data Analytics) at Harvard Extension School">
<meta charset="utf-8">
<style>
body {
	font: 10px sans-serif;
}

.axis path, .axis line {
	fill: none;
	stroke: #000;
	shape-rendering: crispEdges;
}

.line {
	fill: none;
	stroke: steelblue;
	stroke-width: 1.5px;
}

.dotted_line {
	fill: none;
	stroke: steelblue;
	stroke-width: 1.5px;
	stroke-dasharray: 2, 2;
}
</style>
<body>
	<script src="https://d3js.org/d3.v3.min.js"></script>
	<script>
		// create margins for the graph
		var margin = {
			top : 20,
			right : 80,
			bottom : 30,
			left : 100
		}, width = 1260 - margin.left - margin.right, height = 500 - margin.top
				- margin.bottom;

		// create the x scale
		var x = d3.time.scale().rangeRound([ 0, width ]);

		// create y scale
		var y = d3.scale.linear().range([ height, 0 ]);

		// get the color scale
		var color = d3.scale.category10();

		// create x axis
		var xAxis = d3.svg.axis().scale(x).orient("bottom").ticks(d3.time.days,
				1).tickFormat(d3.time.format('%a %d')).tickSize(0).tickPadding(
				8);

		// create y axis
		var yAxis = d3.svg.axis().scale(y).orient("left");

		// create the axis line
		var line = d3.svg.line().interpolate("basis").x(function(d) {
			return x(d.Time);
		}).y(function(d) {
			return y(d.Highway);
		});

		// create the svg componenet got graph
		var svg = d3.select("body").append("svg").attr("width",
				width + margin.left + margin.right).attr("height",
				height + margin.top + margin.bottom).append("g").attr(
				"transform",
				"translate(" + margin.left + "," + margin.top + ")");

		// read the input csv file
		d3.csv("output_files/highway_info.csv", function(error, data) {
			if (error)
				throw error;

			// create a color domain corresponding to each highway
			color.domain(d3.keys(data[0]).filter(function(key) {
				return key !== "Time";
			}));

			data.forEach(function(d) {
				d.Time = +(new Date(d.Time));
			});

			// create the domain map for time and highway
			var highwaySpeeds = color.domain().map(function(name) {
				return {
					name : name,
					values : data.map(function(d) {
						return {
							Time : new Date(d.Time),
							Highway : +d[name]
						};
					})
				};
			});

			// create the x axis domain
			x.domain([
					new Date(data[0].Time),
					d3.time.minute.offset(new Date(data[data.length - 1].Time),
							5) ]);
			
			// set the values on x axis
			xAxis = d3.svg.axis().scale(x).orient("bottom").ticks(
					d3.time.minute, 5).tickFormat(d3.time.format('%I:%M %p'))
					.tickSize(0).tickPadding(8);

			// create y axis domain
			y.domain([ d3.min(highwaySpeeds, function(c) {
				return d3.min(c.values, function(v) {
					return v.Highway;
				});
			}) - 5, d3.max(highwaySpeeds, function(c) {
				return d3.max(c.values, function(v) {
					return v.Highway;
				});
			}) + 5 ]);

			// use svg to plot the x axis
			svg.append("g").attr("class", "x axis").attr("transform",
					"translate(0," + height + ")").call(xAxis).append("text")
					.attr("class", "label").attr("x", width).attr("y", -6)
					.style("text-anchor", "end").text("Time (in Boston MA)")
					.style("font-size", "15px");

			// use svg to plot the y axis
			svg.append("g").attr("class", "y axis").call(yAxis).append("text")
					.attr("transform", "rotate(0)").attr("y", 6).attr("dy",
							".71em").style("text-anchor", "after-edge").text(
							"Average Speed (in MPH)").style("font-size", "15px");

			// read the highway speed data from csv
			var highwaySpeedType = svg.selectAll(".highwaySpeedType").data(
					highwaySpeeds).enter().append("g").attr("class",
					"highwaySpeedType");

			// create the lines on graph for each highway
			highwaySpeedType.append("path").attr("class", "line").attr("d",
					function(d) {
						return line(d.values);
					}).style("stroke", function(d) {
				return color(d.name);
			});

			// add text for each line which will be name of the highway
			highwaySpeedType.append("text").datum(function(d) {
				return {
					name : d.name,
					value : d.values[d.values.length - 1]
				};
			}).style("fill", function(d) {
				return color(d.name);
			}).attr(
					"transform",
					function(d) {
						return "translate(" + x(d.value.Time) + ","
								+ y(d.value.Highway) + ")";
					}).attr("x", 3).attr("y", ".35em").text(function(d) {
				return d.name;
			});
		});
		
	</script>
	<h2 style="color:RED">Refresh the page to get latest information.      The speed information shown after the current timestamp is the speed predicted using Spark Machine Learning</h2>
	<h3>
	This is the output of Final Project of e63 course (Big Data Analytics) submitted by Rohan Pulekar		
	</h3>
	<h2>Topic for the project:</h2><h3>Spark: Event Stream Processing and Machine Learning</h3>
	<h2>What is the information displayed in this graph:</h2><h3>This is real time average speed information of highways in Massachusetts</h3>
	<h2>What is the primary source of this real time information:</h2>
	<h3>Mass DOT live highway info feed: https://www.massdot.state.ma.us/feeds/traveltimes/RTTM_feed.aspx</h3>
	<h2>Prediction aspect:</h2>
	<h3>The speed information displayed upto the current time is retrieved from the above feed.  The speed information displayed after the current time is speed prediction done
	with Spark Machine Learning library Linear Regression API</h3>
</body>