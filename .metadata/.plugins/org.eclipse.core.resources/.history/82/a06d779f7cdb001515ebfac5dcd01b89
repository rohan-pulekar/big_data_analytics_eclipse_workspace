'''
Created on Feb 23, 2016

@author: rpulekar
'''
from pyspark import SparkConf, SparkContext
import string
import sys
# Set the Spark configuration so WordCount is run locally
conf = SparkConf().setMaster('local').setAppName('Assignment4_Problem4')
sc = SparkContext(conf = conf)
# Read all-bible.txt into RDD (Variable called RDDvar)
input_file = sys.argv[1]
output_dir = sys.argv[2]
RDDvar = sc.textFile(input_file)
# Tokenize each line
words = RDDvar.flatMap(lambda line: line.split())
# Converts tokens to lower-case & removes punctuation before creating a tuple (token, 1)
mapOfWords = words.map(lambda word: (str(word.lower()).translate(None,string.punctuation), 1))
filteredMapOfWords = mapOfWords.filter(lambda word, count: len(word)>1)
finalWordCountList = filteredMapOfWords.reduceByKey(lambda a, b: a+b).sortByKey()
finalWordCountList.saveAsTextFile(output_dir)