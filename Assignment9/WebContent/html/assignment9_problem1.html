<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="author" content="Rohan Pulekar">
<meta name="description"
	content="This html file is for Assignment9 Problem1 of e63 course (Big Data Analutics) at Harvard Extension School">
<title>Assignment9 Problem1</title>
<script type="text/javascript" src="../js/d3/d3.js"></script>
<style type="text/css">
.dot {
	stroke: #000;
}

div.tooltip {
	position: absolute;
	text-align: center;
	width: 60px;
	height: 28px;
	padding: 2px; : 18 px sans-serif;
	border: 20px;
	background: white;
	border-radius: 8px;
	pointer-events: none;
	background: white;
}
</style>
</head>
<body>

	<script type="text/javascript">
		// create svg margins
		var svgMargin = {
			top : 20,
			right : 20,
			bottom : 30,
			left : 40
		}, svgWidth = 1260 - svgMargin.left - svgMargin.right, svgHeight = 500
				- svgMargin.top - svgMargin.bottom;

		// define x axis
		var xValue = function(d) {
			return d["Per capita income"];
		};
		var xScale = d3.scale.log().range([ 0, svgWidth ]); // x axis scale is logarithmic scale
		var xMap = function(d) {
			return xScale(xValue(d));
		};
		var xAxis = d3.svg.axis().scale(xScale).orient("bottom").ticks(10,
				",.1s").tickSize(6, 1);

		// define y axis
		var yValue = function(d) {
			return d["Life expectancy in 2015"];
		};
		var yScale = d3.scale.linear().range([ svgHeight, 0 ]); // y axis has a linear scale
		var yMap = function(d) {
			return yScale(yValue(d));
		};
		var yAxis = d3.svg.axis().scale(yScale).orient("left").tickSize(6, 1);

		// create a function that will give a different color for each continent
		var cValue = function(d) {
			return d["Continent"];
		};

		// create an ordinal scale of colors
		var color = d3.scale.category10();

		// add the graph canvas to the body of the webpage
		var svg = d3.select("body").append("svg").attr("width",
				svgWidth + svgMargin.left + svgMargin.right).attr("height",
				svgHeight + svgMargin.top + svgMargin.bottom).append("g").attr(
				"transform",
				"translate(" + svgMargin.left + "," + svgMargin.top + ")");

		// Define div for the country circle tooltip
		var div = d3.select("body").append("div").attr("class", "tooltip")
				.style("opacity", 0);

		// load data from the below mentioned csv file
		d3
				.csv(
						"../input_files/life_expectancy_income.csv",
						function(error, data) {

							// change from string to number format the per capita income and life expectancy fields
							data
									.forEach(function(d) {
										d["Per capita income"] = +d["Per capita income"];
										d["Life expectancy in 2015"] = +d["Life expectancy in 2015"];
									});

							// add buffer to data domain for clarity of the graph
							xScale.domain([ Math.exp(5), Math.exp(13) ]);
							yScale.domain([ d3.min(data, yValue) - 40,
									d3.max(data, yValue) + 20 ]);

							// draw x axis
							svg.append("g").attr("class", "x axis").attr(
									"transform",
									"translate(0," + svgHeight + ")").call(
									xAxis).append("text")
									.attr("class", "label").attr("x", svgWidth)
									.attr("y", -6).style("text-anchor", "end")
									.text("Per capita income");

							// draw y axis
							svg.append("g").attr("class", "y axis").call(yAxis)
									.append("text").attr("class", "label")
									.attr("transform", "rotate(-90)").attr("y",
											6).attr("dy", ".71em").style(
											"text-anchor", "end").text(
											"Life expectancy in 2015");

							// draw a dot for each country
							svg
									.selectAll(".dot")
									.data(data)
									.enter()
									.append("circle")
									.attr("class", "dot")
									.attr("r", function(d) {
										return getRadius(d["Population"]);
									})
									.attr("cx", xMap)
									.attr("cy", yMap)
									.style("fill", function(d) {
										return color(cValue(d));
									})
									.on(
											"mouseover",
											function(d) {
												// get the circle element on which is mouse is over
												var circleElement = d3
														.select(this)[0][0];

												// make the tooltip for the circle visible
												div.transition().duration(200)
														.style("opacity", .9);

												// set the text and coordinates of the tooltip
												div
														.html(d["Country"])
														.style(
																"left",
																(circleElement
																		.getAttribute("cx") - circleElement
																		.getAttribute("r"))
																		+ "px")
														.style(
																"top",
																(circleElement
																		.getAttribute("cy") - circleElement
																		.getAttribute("r"))
																		+ "px");
											}).on(
											"mouseout",
											function(d) {
												// make the tooltip for the circle disappear
												div.transition().duration(500)
														.style("opacity", 0);
											});

							// draw legends
							var legend = svg.selectAll(".legend").data(
									color.domain()).enter().append("g").attr(
									"class", "legend").attr("transform",
									function(d, i) {
										return "translate(0," + i * 20 + ")";
									});

							// draw legend colored rectangles
							legend.append("rect").attr("x", svgWidth - 18)
									.attr("width", 18).attr("height", 18)
									.style("fill", color);

							// draw legend text
							legend.append("text").attr("x", svgWidth - 24)
									.attr("y", 9).attr("dy", ".35em").style(
											"text-anchor", "end").text(
											function(d) {
												return d;
											});
						});

		// this function gets population and gives corresponding radius.  As you can see from the formula, it is proportional to the square root of population
		function getRadius(population) {
			return Math.sqrt(population) / 600;
		}
	</script>
	<div>
		<h1>Assignment9 Problem1</h1>
		<h3>The above graph is for data of year 2015</h3>
	</div>
</body>
</html>